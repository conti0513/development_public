name: AI Worker
on:
  repository_dispatch:
    types: [ai-exec-command]

jobs:
  execute:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create TIL File and PR
        run: |
          # Goå´ã®JSONã‚­ãƒ¼ (category, filename, content) ã«å®Œå…¨æº–æ‹ 
          CATEGORY="${{ github.event.client_payload.category }}"
          FILENAME="${{ github.event.client_payload.filename }}"
          CONTENT="${{ github.event.client_payload.content }}"

          mkdir -p "$CATEGORY"
          
          # ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿
          echo "$CONTENT" > "$CATEGORY/$FILENAME"
          
          git config user.name "AI Junior"
          git config user.email "ai-junior@example.com"
          
          BRANCH_NAME="ai-til-$(date +'%s')"
          git checkout -b $BRANCH_NAME
          git add .
          git commit -m "ğŸ¤– AI Entry: $FILENAME"
          git push origin $BRANCH_NAME
          
          gh pr create --title "ğŸ¤– AI Entry: $FILENAME" --body "SlackæŠ•ç¨¿ã‹ã‚‰CTOæµTILãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§è‡ªå‹•ç”Ÿæˆã—ã¾ã—ãŸã€‚" --base main --head $BRANCH_NAME
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
