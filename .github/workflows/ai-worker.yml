name: AI Worker
on:
  repository_dispatch:
    types: [ai-exec-command]

jobs:
  execute:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create TIL File and PR
        run: |
          mkdir -p 01_TIL
          FILENAME="01_TIL/$(date +'%Y%m%d_%H%M%S')_til.md"
          echo "${{ github.event.client_payload.message }}" > $FILENAME
          
          git config user.name "AI Junior"
          git config user.email "ai-junior@example.com"
          
          BRANCH_NAME="ai-til-$(date +'%s')"
          git checkout -b $BRANCH_NAME
          git add .
          git commit -m "ğŸ¤– AI Entry: TIL Update"
          git push origin $BRANCH_NAME
          
          gh pr create --title "ğŸ¤– AI Entry: New TIL Found" --body "Slackã‹ã‚‰ã®æŠ•ç¨¿ã‚’åŸºã«ç”Ÿæˆã—ã¾ã—ãŸã€‚" --base main --head $BRANCH_NAME
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
