# 🌌 OpenGemini-Lite 運用ツールセット (Operational Tools)

本リポジトリには、Google Cloud Run 上で動作する AI エージェントの「ビルド・デプロイ・観測・診断」を迅速に行うためのシェルスクリプト群が整備されています。

## 📋 ツール一覧と用途

各スクリプトは、作業フェーズに合わせて番号順（01〜04）に使用することを想定しています。

| No | スクリプト名 | 用途 | 実行タイミング |
| --- | --- | --- | --- |
| **01** | `01_deploy-and-check.sh` | **高速デプロイ & 疎通確認** | ロジック修正後、シークレット連携を含めて即座に反映したい時。 |
| **02** | `02_clean-deploy.sh` | **環境浄化デプロイ** | ビルドキャッシュの不整合や、Artifact Registry の肥大化を解消したい時。 |
| **03** | `03_monitor-agent.sh` | **リアルタイム・思考観測** | 非同期処理中の Gemini の推論や GitHub Dispatch の進捗を追跡したい時。 |
| **04** | `04_check-auth.sh` | **インフラ健康診断** | 「動かない」と感じた際、Secret/IAM/連携設定を 5 秒で切り分けたい時。 |

---

## 🛠 各スクリプトの詳細説明

### 01. `01_deploy-and-check.sh`

Cloud Run へのソースデプロイを実行します。今回の修正により、**環境変数の手動 export は不要** となり、Secret Manager からの自動取得・紐付けが完結します。

* **特徴**: `--clear-env-vars` により古い設定を掃除し、タイムアウト 300 秒の「長時間耐久設定」を自動適用します。

### 02. `02_clean-deploy.sh`

Artifact Registry のリポジトリを再作成し、キャッシュを物理的に排除した状態でビルドを行います。

* **特徴**: 「さっき直したはずなのに反映されない」といった、クラウド特有のキャッシュ問題に終止符を打ちます。

### 03. `03_monitor-agent.sh`

`gcloud logging` を活用し、特定のキーワード（Error, ❌, GitHub, PR, Slack）に絞ったログを抽出・表示します。

* **特徴**: 非同期（Goroutine）で動くエージェントの「脳内」を可視化。Slack の 3 秒制限の裏側で起きている重い処理をリアルタイムで追跡できます。

### 04. `04_check-auth.sh`

Secret Manager のアクセス権、サービスアカウントの IAM、Cloud Run の `envFrom` 設定の整合性をチェックします。

* **特徴**: **「コードが悪いのか、インフラが悪いのか」を即座に判定。** 開発者の粘りを支える、運用上最も信頼すべき診断ツールです。

---

## 🚀 理想的な開発フロー

1. **診断**: **`./04_check-auth.sh`** で鍵と権限が生きているか確認。
2. **実装・反映**: `main.go` 修正後、**`./01_deploy-and-check.sh`** でデプロイ。
3. **観測**: 別ターミナルで **`./03_monitor-agent.sh`** を起動。
4. **実験**: Slack で指示を飛ばし、Gemini の思考ログを眺めながら PR の生成を待つ。

---
